const questions = [{
        "question": "¿Cuál es el objetivo principal de la gestión de continuidad de servicios de TI?",
        "options": [{
                "response": "Mejorar el rendimiento del hardware",
                "answer": false
            },
            {
                "response": "Asegurar la continuidad de los servicios críticos de TI en caso de interrupciones",
                "answer": true
            },
            {
                "response": "Incrementar las ventas",
                "answer": false
            },
            {
                "response": "Desarrollar nuevos productos",
                "answer": false
            }
        ],
        "answer_input": null
    },
    {
        "question": "¿Qué componente es esencial en un plan de continuidad de servicios de TI?",
        "options": [{
                "response": "Estrategias de mitigación de riesgos",
                "answer": true
            },
            {
                "response": "Plan de marketing",
                "answer": false
            },
            {
                "response": "Estrategias de ventas",
                "answer": false
            },
            {
                "response": "Diseño gráfico",
                "answer": false
            }
        ],
        "answer_input": null
    },
    {
        "question": "¿Cuál de los siguientes NO es un beneficio de tener un plan de continuidad de servicios de TI?",
        "options": [{
                "response": "Reducción del tiempo de inactividad",
                "answer": false
            },
            {
                "response": "Mejorar la eficiencia operativa",
                "answer": false
            },
            {
                "response": "Aumento de la visibilidad online",
                "answer": true
            },
            {
                "response": "Mitigación de riesgos",
                "answer": false
            }
        ],
        "answer_input": null
    },
    {
        "question": "¿Qué es ISO/IEC 22301?",
        "options": [{
                "response": "Un estándar internacional para la gestión de la continuidad del negocio",
                "answer": true
            },
            {
                "response": "Un sistema operativo",
                "answer": false
            },
            {
                "response": "Un lenguaje de programación",
                "answer": false
            },
            {
                "response": "Un software de diseño gráfico",
                "answer": false
            }
        ],
        "answer_input": null
    },
    {
        "question": "¿Cuál es el propósito principal de implementar ISO/IEC 22301 en una organización?",
        "options": [{
                "response": "Asegurar la disponibilidad de servicios críticos durante y después de una interrupción",
                "answer": true
            },
            {
                "response": "Mejorar el diseño gráfico",
                "answer": false
            },
            {
                "response": "Incrementar las ventas",
                "answer": false
            },
            {
                "response": "Realizar campañas de marketing",
                "answer": false
            }
        ],
        "answer_input": null
    },
    {
        "question": "¿Cuál de los siguientes es un componente clave en la implementación de ISO/IEC 22301?",
        "options": [{
                "response": "Análisis de impacto en el negocio (BIA)",
                "answer": true
            },
            {
                "response": "Diseño de páginas web",
                "answer": false
            },
            {
                "response": "Estrategias de ventas",
                "answer": false
            },
            {
                "response": "Investigación de mercado",
                "answer": false
            }
        ],
        "answer_input": null
    },
    {
        "question": "¿Cuál de las siguientes herramientas se utiliza para la auditoría de sistemas de información?",
        "options": [{
                "response": "Nessus",
                "answer": true
            },
            {
                "response": "Photoshop",
                "answer": false
            },
            {
                "response": "Excel",
                "answer": false
            },
            {
                "response": "Word",
                "answer": false
            }
        ],
        "answer_input": null
    },
    {
        "question": "¿Qué función principal realiza la herramienta Metasploit en la auditoría de sistemas de información?",
        "options": [{
                "response": "Edición de imágenes",
                "answer": false
            },
            {
                "response": "Pruebas de penetración",
                "answer": true
            },
            {
                "response": "Creación de documentos",
                "answer": false
            },
            {
                "response": "Gestión de proyectos",
                "answer": false
            }
        ],
        "answer_input": null
    },
    {
        "question": "¿Cuál es el propósito de usar herramientas de auditoría de sistemas de información como Splunk?",
        "options": [{
                "response": "Analizar datos y generar informes de seguridad",
                "answer": true
            },
            {
                "response": "Diseñar logotipos",
                "answer": false
            },
            {
                "response": "Incrementar las ventas",
                "answer": false
            },
            {
                "response": "Realizar campañas de marketing",
                "answer": false
            }
        ],
        "answer_input": null
    },
    {
        "question": "¿Qué es un plan de continuidad del servicio de TI?",
        "options": [{
                "response": "Un documento que detalla las estrategias para mantener los servicios de TI operativos durante y después de una interrupción",
                "answer": true
            },
            {
                "response": "Un plan de marketing",
                "answer": false
            },
            {
                "response": "Un informe financiero",
                "answer": false
            },
            {
                "response": "Una estrategia de ventas",
                "answer": false
            }
        ],
        "answer_input": null
    },
    {
        "question": "¿Cuál de los siguientes es un componente del plan de continuidad del servicio de TI?",
        "options": [{
                "response": "Análisis de impacto en el negocio (BIA)",
                "answer": true
            },
            {
                "response": "Plan de ventas",
                "answer": false
            },
            {
                "response": "Estrategias de marketing",
                "answer": false
            },
            {
                "response": "Desarrollo de productos",
                "answer": false
            }
        ],
        "answer_input": null
    },
    {
        "question": "¿Qué es una prueba de continuidad del negocio?",
        "options": [{
                "response": "Un ejercicio para evaluar la efectividad del plan de continuidad",
                "answer": true
            },
            {
                "response": "Una estrategia de ventas",
                "answer": false
            },
            {
                "response": "Un análisis de mercado",
                "answer": false
            },
            {
                "response": "Una campaña de marketing",
                "answer": false
            }
        ],
        "answer_input": null
    },
    {
        "question": "¿Cuál es la primera fase de la metodología de auditoría informática?",
        "options": [{
                "response": "Planificación",
                "answer": true
            },
            {
                "response": "Recolección de información",
                "answer": false
            },
            {
                "response": "Ejecución de pruebas de auditoría",
                "answer": false
            },
            {
                "response": "Elaboración del informe de auditoría",
                "answer": false
            }
        ],
        "answer_input": null
    },
    {
        "question": "¿Qué se realiza durante la fase de recolección de información en una auditoría informática?",
        "options": [{
                "response": "Revisión de documentación y entrevistas con el personal",
                "answer": true
            },
            {
                "response": "Desarrollo de productos",
                "answer": false
            },
            {
                "response": "Campañas de marketing",
                "answer": false
            },
            {
                "response": "Estrategias de ventas",
                "answer": false
            }
        ],
        "answer_input": null
    },
    {
        "question": "¿Cuál es el objetivo principal de la fase de ejecución de pruebas de auditoría?",
        "options": [{
                "response": "Evaluar la efectividad de los controles internos",
                "answer": true
            },
            {
                "response": "Incrementar las ventas",
                "answer": false
            },
            {
                "response": "Diseñar logotipos",
                "answer": false
            },
            {
                "response": "Realizar encuestas",
                "answer": false
            }
        ],
        "answer_input": null
    },
    {
        "question": "¿Qué son las estrategias de contingencia en el ciclo de vida de desarrollo de un sistema TI?",
        "options": [{
                "response": "Planes para mitigar el impacto de eventos inesperados durante el desarrollo de un sistema",
                "answer": true
            },
            {
                "response": "Estrategias de ventas",
                "answer": false
            },
            {
                "response": "Análisis de mercado",
                "answer": false
            },
            {
                "response": "Campañas de marketing",
                "answer": false
            }
        ],
        "answer_input": null
    },
    {
        "question": "¿En qué fase del ciclo de vida de desarrollo de un sistema TI se implementan las estrategias de contingencia?",
        "options": [{
                "response": "Análisis de requisitos",
                "answer": true
            },
            {
                "response": "Publicidad",
                "answer": false
            },
            {
                "response": "Marketing",
                "answer": false
            },
            {
                "response": "Finanzas",
                "answer": false
            }
        ],
        "answer_input": null
    },
    {
        "question": "¿Cuál es el propósito de las estrategias de contingencia en el desarrollo de un sistema TI?",
        "options": [{
                "response": "Asegurar la continuidad del desarrollo en caso de interrupciones",
                "answer": true
            },
            {
                "response": "Incrementar las ventas",
                "answer": false
            },
            {
                "response": "Mejorar el diseño gráfico",
                "answer": false
            },
            {
                "response": "Realizar encuestas",
                "answer": false
            }
        ],
        "answer_input": null
    },
    {
        "question": "Las amenazas se __________ de las vulnerabilidades",
        "options": null,
        "answer_input": ["aprovechan", "basan"]
    },
    {
        "question": "Cual es el orden del ciclo OODA",
        "options": [{
                "response": "Observar, orientar, decidir y actuar",
                "answer": true
            },
            {
                "response": "Orientar, observar, actuar y decidir",
                "answer": false
            },
            {
                "response": "Decidir, observar, actuar y orientar",
                "answer": false
            },
            {
                "response": "Actuar, decider, observar y orientar",
                "answer": false
            }
        ],
        "answer_input": null
    },
    {
        "question": "___________ es una progresión que siguen los atacantes",
        "options": null,
        "answer_input": ["kill chain"]
    },
    {
        "question": "Cual es la suceción de kill chain",
        "options": [{
                "response": "Reconocimiento, armamento, entrega, explotación, instalación, comando y control, acción sobre el objetivo",
                "answer": true
            },
            {
                "response": "Entrega, explotación, instalación, comando y control, acción sobre el objetivo, reconocimiento, armamento",
                "answer": false
            },
            {
                "response": "Explotación, instalación, comando y control, acción sobre el objetivo, reconocimiento, armamento, entrega",
                "answer": false
            },
            {
                "response": "Comando y control, acción sobre el objetivo, reconocimiento, explotación, instalación, armamento, entrega",
                "answer": false
            }
        ],
        "answer_input": null
    },
    {
        "question": "Cual es el significado de las siglas CSIRT",
        "options": [{
                "response": "Computer Security Incident Response Team",
                "answer": true
            },
            {
                "response": "Computo Secure Incident Request Team",
                "answer": false
            },
            {
                "response": "Center Security Increment Response Team",
                "answer": false
            },
            {
                "response": "Center Security Inicial Response Team",
                "answer": false
            }
        ],
        "answer_input": null
    },
    {
        "question": "Cual es un SIEM",
        "options": [{
                "response": "Es un equipo dedicado de la casa de amenazas",
                "answer": true
            },
            {
                "response": "Software de seguridad que les da a las organizaciones una vista general de la actividad en toda su red",
                "answer": false
            },
            {
                "response": "Es un software de gestion de incidentes",
                "answer": false
            },
            {
                "response": "Es un software para la gestion de la amenazas identificadas y la documentacion de los planes de contingencia",
                "answer": false
            }
        ],
        "answer_input": null
    },{
        "question": "Cual es el ciclo de caza",
        "options": [{
                "response": "Hipotesis, Investigar, Descubrir patrones, Informar",
                "answer": true
            },
            {
                "response": "Investigar, Descubrir patrones, Informar, Hipotesis",
                "answer": false
            },
            {
                "response": "Descubrir patrones, Informar, Hipotesis, Investigar",
                "answer": false
            },
            {
                "response": "Informar, Investigar, Hipotesis, Descubrir patrones",
                "answer": false
            }
        ],
        "answer_input": null
    },
    {
        "question": "Mensiona tres plataformas para THREAT HUNTING",
        "options": null,
        "answer_input": [
            "Hunting ELK",
            "DETECTION LAB",
            "SOF ELK"
        ]
    },
]


document.addEventListener("DOMContentLoaded", () => {
    const quizContainer = document.getElementById("quiz-container");
    const submitButton = document.getElementById("submit");
    const reloadButton = document.createElement("button");
    const resultContainer = document.getElementById("result");

    reloadButton.innerHTML = "Recargar";
    reloadButton.setAttribute("id", "reload");
    reloadButton.style.display = "none";
    reloadButton.addEventListener("click", () => location.reload());

    function shuffleArray(array) {
        for (let i = array.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [array[i], array[j]] = [array[j], array[i]];
        }
        return array;
    }

    function questionsGenerate() {
        var questionsG = [];
        var generatedNumbers = new Set();

        while (questionsG.length < 16) {
            var rn = getRandomInt(questions.length);
            if (!generatedNumbers.has(rn)) {
                generatedNumbers.add(rn);
                questionsG.push(questions[rn]);
            }
        }

        return questionsG;
    }

    function getRandomInt(max) {
        return Math.floor(Math.random() * max);
    }
    /* function shuffleOptions(options) {
        for (let i = options.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [options[i], options[j]] = [options[j], options[i]];
        }
        return options;
    } */
    function buildQuiz() {
        const output = [];
        const shuffledQuestions = questionsGenerate();

        shuffledQuestions.forEach((currentQuestion, questionNumber) => {
            const options = [];

            if (currentQuestion.options) {
                // Mezclamos las opciones antes de mostrarlas
                const shuffledOptions = shuffleArray([...currentQuestion.options]);

                shuffledOptions.forEach((option, i) => {
                    options.push(
                        `<label>
                                <input type="${currentQuestion.options.some(opt => opt.answer) ? 'checkbox' : 'radio'}" name="question${questionNumber}" value="${currentQuestion.options.indexOf(option)}">
                                ${option.response}
                            </label>`
                    );
                });
            } else {
                // Si no hay opciones, manejamos la pregunta como un input de texto
                options.push(
                    `<label>
                            <input type="text" name="question${questionNumber}" placeholder="Tu respuesta">
                        </label>`
                );
            }

            output.push(
                `<div class="question">
                        <h3>${questionNumber + 1}. ${currentQuestion.question}</h3>
                        <div class="options">${options.join('')}</div>
                    </div>`
            );
        });

        quizContainer.innerHTML = output.join('');
    }




    function showResults() {
        const answerContainers = quizContainer.querySelectorAll('.options');
        let numCorrect = 0;
    
        questions.forEach((currentQuestion, questionNumber) => {
            const answerContainer = answerContainers[questionNumber];
            if (!answerContainer) return;
    
            if (currentQuestion.options) {
                const selector = `input[name=question${questionNumber}]`;
                const userAnswers = Array.from(answerContainer.querySelectorAll(selector)).filter(input => input.checked).map(input => parseInt(input.value));
    
                const isCorrect = userAnswers.every(index => currentQuestion.options[index].answer) &&
                                  currentQuestion.options.filter(option => option.answer).length === userAnswers.length;
    
                if (isCorrect) {
                    numCorrect++;
                    userAnswers.forEach(val => {
                        answerContainer.querySelectorAll('label')[val].style.color = 'green';
                    });
                } else {
                    userAnswers.forEach(val => {
                        answerContainer.querySelectorAll('label')[val].style.color = 'red';
                    });
                    currentQuestion.options.forEach((option, index) => {
                        if (option.answer) {
                            // Aseguramos que estamos accediendo al elemento correcto en el DOM
                            try {
                                answerContainer.querySelectorAll('label')[index].style.color = 'green';
                            } catch (error) {
                                
                            }
                            
                        }
                    });
                }
            } else if (currentQuestion.answer_input) {
                const userAnswerElement = answerContainer.querySelector(`input[name=question${questionNumber}]`);
    
                if (userAnswerElement) {
                    const userAnswer = userAnswerElement.value.toLowerCase().replace(/,/g, ' ');
                    const correctAnswers = currentQuestion.answer_input.map(a => a.toLowerCase());
    
                    const isCorrect = correctAnswers.every(ans => userAnswer.includes(ans));
    
                    if (isCorrect) {
                        numCorrect++;
                        answerContainer.innerHTML += `<span style="color: green;"> ✓ ${correctAnswers.join(', ')}</span>`;
                    } else {
                        answerContainer.innerHTML += `<span style="color: red;"> X ${correctAnswers.join(', ')}</span>`;
                    }
                }
            }
        });
    
        resultContainer.innerHTML = `Has acertado ${numCorrect} de ${questions.length} preguntas.`;
        submitButton.style.display = "none";
        reloadButton.style.display = "block";
    }
    





    buildQuiz();

    submitButton.addEventListener('click', showResults);
    document.body.appendChild(reloadButton);
});